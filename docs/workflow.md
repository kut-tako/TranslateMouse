# アプリケーション処理フロー説明資料

## 概要

TranslateMouseはウィンドウ制御のメインスレッドとホットキー制御のデーモンスレッドで動作しています。  
起動時に「ウィンドウの初期化処理」「ホットキーリスナーのデーモンスレッドの起動」と「マウスの位置追跡処理の起動」を行います。  
その後、アプリがホットキー入力待機状態になり、入力を受け取ったら翻訳処理を実行されます。  
翻訳処理が終わり次第、再度アプリはホットキー入力待機状態になります。  

## 処理フロー

1. **アプリケーションの起動**
   - ユーザーがアプリケーションを起動するとウィンドウとホットキーリスナーの初期化が行われます。ウィンドウが表示され、初期メッセージが表示されます。
   - 初期化処理では以下の処理が行われます。
     - ホットキーリスナーをデーモンスレッドで起動
     - ウィンドウの初期表示の設定
     - ループ処理として定期的なマウス位置の追跡処理を設定

2. **マウスの位置追跡**
   - 定期的に`update_mouse_position`メソッドを呼び出して、マウスの位置をリアルタイムで追跡します。マウスの位置は、`mouse_x`と`mouse_y`の変数に保存し、後続の処理に使用します。

3. **ホットキー入力**
   - ショートカットキー（Shift + A）が押されるまでホットキーリスナーのデーモンスレッドが待機します。
   - ショートカットキー（Shift + A）を押すと、デーモンスレッドからメインスレッドのインスタンスを使用して`translate_process`メソッドが呼び出されます。
   - `translate_process`メソッドはスクリーンショットの取得、OCRによるテキスト認識、検出したテキストの検証、翻訳の実行、翻訳結果を基にラベルに更新まで行います。

4. **スクリーンショットの取得**
   - `_take_screenshot`メソッドを呼び出して、現在のマウス位置を中心としたスクリーンショットを取得します。
   - このメソッドは取得したスクリーンショットのファイル名を返すので`translate_process`メソッド内の変数に格納し、後続の処理に使用します。

5. **OCRによるテキスト認識**
   - `_get_text_from_ocr`メソッドを呼び出して、OCR技術（Tessaract）で画像内のテキストを認識し、認識した文字列と文字列の位置を取得します。
   - この時、認識した文字列と文字列の位置は複数返ってくることがあります。
   - このメソッドは、認識した文字列と文字列の位置をリストに入れて返すので`translate_process`メソッド内の変数に格納し、後続の処理に使用します。

6. **テキストの検証**
   - 認識した文字列と文字列の位置が格納されたリストが空でないかを確認します。空の場合は、処理をスキップしてユーザーに「文字検出無し」と表示して`translate_process`メソッドを終了します。
   - 空ではない場合、`_check_text_position`メソッドを呼び出して、認識した文字列の中からマウスの位置と認識した文字列の位置が重なっているものを1つ探します。
   - `_check_text_position`メソッドから返却された文字列が空の場合は、処理をスキップしてユーザーに「翻訳対象無し」と表示して`translate_process`メソッドを終了します。
   - 空ではない場合、このメソッドはマウスと重なる英単語を返すので`translate_process`メソッド内の変数に格納し、後続の処理に使用します。

7. **翻訳の実行**
   - `_translate_word`メソッドを呼び出して、DeepLAPIを使用して認識した英単語を翻訳します。
   - このメソッドは、翻訳返すので`translate_process`メソッド内の変数に格納し、後続の処理に使用します。

8. **翻訳結果の表示**
   - `update_label`メソッドを呼び出して、翻訳結果をラベルに表示し、ユーザーに結果を通知します。
   - この処理が完了すると`translate_process`は終了し、再度「3. **ホットキー入力**」の処理に戻ります。

## アプリの作成理由

- **自分が英語でゲームをしつつ、英語の学習をしたいと考えた時に英単語を素早く調べるツールが欲しかったため**
- 英単語のみの翻訳にした理由
  - 英文をすべて翻訳するより、英語力向上につながると考えたため
  - この仕様なら一度に翻訳する量を減らせて処理速度を上げられるため
  - 既存アプリは英文を翻訳するアプリが多いので独自性を持たせることができるため
